.PC02

.INCLUDE "INSTRUCTIONS.MAC"
.INCLUDE "XM7SEG.MAC"


.MACRO NOPS N
	.REPEAT N
		NOP
	.ENDREPEAT
.ENDMACRO

.MACRO WREG VAL, REG
	LDA #VAL
	STA VDP+1
	NOPS 20
	LDA #$80+REG
	STA VDP+1
	NOPS 20
.ENDMACRO

.MACRO WAIT N
@1:	.REPEAT N
		NOP
	.ENDREPEAT
	DEX
	BNE @1
	DEY
	BNE @1
.ENDMACRO


.SEGMENT "ZEROPAGE"
SECONDS_BUFFER:	.RES 2


.SEGMENT "STARTUP"

XMICRO_MEMORY = $7100
RTC = XMICRO_MEMORY+$10

VDP = $7400


_INIT:
	SEI
	CLC
	LDX #$FF
	TXS

;----RTC INIT---
	LDA #%00000000		;DISABLE INTERRUPTS
	STA RTC+$0C

	JSR XM7SEG_INIT
	XM7SEG_ON
	XM7SEG_WORD #$1111

;----VDP INIT----
	WREG %00000000, $00	;$00, $80
	WREG %01010000, $01	;$50, $81
	WREG %00000000, $02	;$00, $82
	WREG %00000001, $04	;$01, $84
	WREG %11110000, $07	;$F0, $87
	WREG %00001000, $08	;$09, $88
	WREG %00000000, $09	;$00, $89

	LDA #$00
	TAX
	TAY

;----PATTERN GENERATOR INIT----
	WREG %00000000, $14
 	MVA #%00000000, VDP+1
	MVA #%01000000, VDP+1		;SET UP ADDRESS ($0000), WRITE-MODE

	LDX #$00
	LDY #$03

	LDA #$00

@1:	STA VDP+0
	NOPS 20
	DEX
	BNE @1
	DEY
	BNE @1


	JMP _MAIN

.SEGMENT "CODE"

_MAIN:
	JMP _MAIN

	WAIT 25
P1:	XM7SEG_WORD #$0001
	WREG %00000000, $09
