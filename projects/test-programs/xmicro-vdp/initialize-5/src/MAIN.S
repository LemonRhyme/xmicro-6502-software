.PC02

.INCLUDE "INSTRUCTIONS.MAC"
.INCLUDE "XM7SEG.MAC"


.MACRO NOPS N
	.REPEAT N
		NOP
	.ENDREPEAT
.ENDMACRO

.MACRO WREG VAL, REG
	LDA #VAL
	STA VDP+1
	LDA #$80+REG
	STA VDP+1
.ENDMACRO

.MACRO WAIT N
.LOCAL @1
	PHX
	PHY
	LDX #$00
	LDY #$00
@1:	.REPEAT N
		NOP
	.ENDREPEAT
	DEX
	BNE @1
	DEY
	BNE @1
	PLY
	PLX
.ENDMACRO


.SEGMENT "ZEROPAGE"
SECONDS_BUFFER:	.RES 2


.SEGMENT "STARTUP"

XMICRO_MEMORY = $7100
RTC = XMICRO_MEMORY+$10

VDP = $7400


_INIT:
	SEI
	CLC
	LDX #$FF
	TXS

;----RTC INIT---
	LDA #%00000000		;DISABLE INTERRUPTS
	STA RTC+$0C

	JSR XM7SEG_INIT
	XM7SEG_ON
	XM7SEG_WORD #$1111

;----VDP INIT----
;	WREG %00000000, 0	;$00, $80	;TEXT1 MODE
;	WREG %01010000, 1	;$50, $81

	WREG %00000100, 0	;$04, $80	;TEXT2 MODE
	WREG %01010000, 1	;$50, $81

;	WREG %00000100, 0	;$04, $80	;MC MODE
;	WREG %01011000, 1	;$58, $81


	WREG %00000011, 2	;$00, $82
	WREG %00101111, 3
	WREG %00000010, 4	;$01, $84
	WREG %11110000, 7	;$F0, $87
	WREG %00001000, 8	;$09, $88
	WREG %00000000, 9	;$00, $89
	WREG %00000000, 10

	WREG %00000100, 25	;ENABLE WAIT OUTPUT

	LDA #$00
	TAX
	TAY

;----PATTERN LAYOUT INIT----
	WREG %00000000, 14
 	MVA #%00000000, VDP+1
	MVA #%01000000, VDP+1		;SET UP ADDRESS ($0000), WRITE-MODE

	LDX #$00
	LDY #$9

	LDA #$00

@1:	STA VDP+0
	NOPS 10
	DEX
	BNE @1
	DEY
	BNE @1

;----PATTERN GENERATOR INIT----
	WREG %00000000, 14
	MVA #%00000000, VDP+1
	MVA #%01010000, VDP+1		;SET UP ADDRESS ($1000), WRITE-MODE

	MVA #%00100000, VDP+0
	NOPS 10
	MVA #%01010000, VDP+0
	NOPS 10
	MVA #%10001000, VDP+0
	NOPS 10
	MVA #%10001000, VDP+0
	NOPS 10
	MVA #%11111000, VDP+0
	NOPS 10
	MVA #%10001000, VDP+0
	NOPS 10
	MVA #%10001000, VDP+0
	NOPS 10
	MVA #%00000000, VDP+0
	NOPS 10


;----PATTERN LAYOUT INIT----
	WREG %00000000, 14
 	MVA #%00000000, VDP+1
	MVA #%01000000, VDP+1		;SET UP ADDRESS ($0000), WRITE-MODE
	LDX #$00
	WAIT 100

	JMP _MAIN

.SEGMENT "CODE"

_MAIN:
	STX VDP+0
	NOPS 10
inx
	STX VDP+0
	NOPS 10
inx
	STX VDP+0
	NOPS 10
inx
	STX VDP+0
	NOPS 10
inx
	STX VDP+0
	WAIT 1
	INX
	JMP _MAIN
